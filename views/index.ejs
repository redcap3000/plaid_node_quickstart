<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Plaid Quickstart Example</title>
<link rel="stylesheet" href="https://threads.plaid.com/threads.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="style.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <main class="main">
    <div class="grid">
      <div class="grid__column grid__column--is-twelve-columns">
        <div id="banner" class="everpresent-content">
          <h1 class="everpresent-content__heading">Account Summary</h1>
          <p id="intro" class="everpresent-content__subheading">
            An example application that outlines an end-to-end integration with Plaid
          </p>
         
          <div id="cashIn" class="everpresent-content__subheading item-data-row__left cashIn">
          </div>
          <div id="cashOut" class="everpresent-content__subheading item-data-row__center cashOut">
          </div>
          <div id="cashNet" class="everpresent-content__subheadingitem-data-row__center cashNet">
          </div>
        </div>

        <div id="container" class="initial-view">
          <p class="initial-view__description">
            Click the button below to open a list of Institutions. After you select one, youâ€™ll be guided through an authentication process. Upon completion, you'll recieve an access_token. You may want to bookmark the page it redirects to that will contain your access token to avoid repeating the process
          </p>

          <button id="link-btn" class="button button--is-primary" disabled>Connect with Plaid</button>
          <div class="loading-indicator"></div>
        </div>

        <div id="app" class="connected-view">

          <div class="box">

            <!-- transaction grouping counts? -->

            <div class="item-data-row" id="transactionGrouping">

            </div>

            <!--Transactions -->
            <div class="item-data-row">
              <div class="item-data-row__left">
                <div class="item-data-row__request-type">post</div>
              </div>
              <div class="item-data-row__center">
                <div class="item-data-row__nicename">Transactions</div>
                <div class="item-data-row__endpoint">/transactions/get</div>
                <div class="item-data-row__description">Retrieve transactions for this month.</div>
              </div>
              <div class="item-data-row__right">
                <button id="get-transactions-btn" class="button button--is-small button--is-default button--is-full-width">Send request</button>
              </div>
              <div class="item-data-row__response">
                <table><tbody id="get-transactions-data"></tbody></table>
              </div>
            </div>
        <!--Transactions2 -->
            <div class="item-data-row">
              <div class="item-data-row__left">
                <div class="item-data-row__request-type">post</div>
              </div>
              <div class="item-data-row__center">
                <div class="item-data-row__nicename">Transactions 2</div>
                <div class="item-data-row__endpoint">/transactions/get</div>
                <div class="item-data-row__description">Retrieve transactions for the previous month.</div>
              </div>
              <div class="item-data-row__right">
                <button id="get-transactions2-btn" class="button button--is-small button--is-default button--is-full-width">Send request</button>
              </div>
              <div class="item-data-row__response">
                <table><tbody id="get-transactions2-data"></tbody></table>
              </div>
            </div>
        <!--Transactions3 -->
            <div class="item-data-row">
              <div class="item-data-row__left">
                <div class="item-data-row__request-type">post</div>
              </div>
              <div class="item-data-row__center">
                <div class="item-data-row__nicename">Transactions 3</div>
                <div class="item-data-row__endpoint">/transactions/get</div>
                <div class="item-data-row__description">Retrieve transactions for 2 months ago.</div>
              </div>
              <div class="item-data-row__right">
                <button id="get-transactions3-btn" class="button button--is-small button--is-default button--is-full-width">Send request</button>
              </div>
              <div class="item-data-row__response">
                <table><tbody id="get-transactions3-data"></tbody></table>
              </div>
            </div>
            <!-- Identity -->
            <div class="item-data-row">
              <div class="item-data-row__left">
                <div class="item-data-row__request-type">post</div>
              </div>
              <div class="item-data-row__center">
                <div class="item-data-row__nicename">Identity</div>
                <div class="item-data-row__endpoint">/identity/get</div>
                <div class="item-data-row__description">Retrieve Identity information on file with the bank. Reduce fraud by comparing user-submitted data to validate identity.</div>
              </div>
              <div class="item-data-row__right">
                <button id="get-identity-btn" class="button button--is-small button--is-default button--is-full-width">Send request</button>
              </div>
              <div class="item-data-row__response">
                <table><tbody id="get-identity-data"></tbody></table>
              </div>
            </div>

            <!-- Balance -->
            <div class="item-data-row">
              <div class="item-data-row__left">
                <div class="item-data-row__request-type">post</div>
              </div>
              <div class="item-data-row__center">
                <div class="item-data-row__nicename">Balance</div>
                <div class="item-data-row__endpoint">/accounts/balance/get</div>
                <div class="item-data-row__description">Check balances in real time to prevent non-sufficient funds fees.</div>
              </div>
              <div class="item-data-row__right">
                <button id="get-balance-btn" class="button button--is-small button--is-default button--is-full-width">Send request</button>
              </div>
              <div class="item-data-row__response">
                <table><tbody id="get-balance-data"></tbody></table>
              </div>
            </div>

          </div>

        </div>
      </div>
    </div>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
  <script>
  (function($) {
    // global vars for reference elsewhere (eventually depreciating JQUERY BS)
    transactionData=true
    transactionData2=true
    // Handles redirect from the oauth response page for the oauth flow.
    if (document.referrer != null && document.referrer.includes('http://localhost:8000/oauth-response.html')) {
      $('#container').fadeOut('fast', function() {
        $('#item_id').text('<%= ITEM_ID %>');
        $('#access_token').text('<%= ACCESS_TOKEN %>');
        $('#intro').hide();
        $('#app, #steps').fadeIn('slow');
      });
    }


    var products = '<%= PLAID_PRODUCTS %>'.split(',');
    if (products.includes('assets')) {
      $('#assets').show();
    }

    var linkHandlerCommonOptions = {
      apiVersion: 'v2',
      clientName: 'Plaid Quickstart',
      env: '<%= PLAID_ENV %>',
      product: products,
      key: '<%= PLAID_PUBLIC_KEY %>',
      countryCodes: '<%= PLAID_COUNTRY_CODES %>'.split(','),
    };
    var oauthRedirectUri = '<%= PLAID_OAUTH_REDIRECT_URI %>';
    if (oauthRedirectUri != '') {
      linkHandlerCommonOptions.oauthRedirectUri = oauthRedirectUri;
    }
    var oauthNonce = '<%= PLAID_OAUTH_NONCE %>';
    if (oauthNonce != '') {
      linkHandlerCommonOptions.oauthNonce = oauthNonce;
    }
    // This functionality is only relevant for the UK Payment Initiation product.
    if (products.includes('payment_initiation')) {
      $('.payment_initiation').show();
      $.post('/set_payment_token', {}, function(data) {
        var paymentToken = data.paymentToken;
        $('#payment_token').text(paymentToken);

        // In the case of payment_initiation product, we need to wait for
        // payment token to be generated before the Link handler can be
        // initialized.
        handler = Plaid.create({
          ...linkHandlerCommonOptions,
          paymentToken: paymentToken,
          language: 'en',
          onSuccess: function(public_token) {
            // This public token exchange step is not relevant for the
            // payment_initiation product and should be skipped.
            $.post('/get_access_token', {
              public_token: public_token
            }, function(data) {
              $('#container').fadeOut('fast', function() {
                $('#item_id').text(data.item_id);
                $('#access_token').text(data.access_token);
                $('#intro').hide();
                $('#app, #steps').fadeIn('slow');
              });
            });
          },
        });
        $('#link-btn').attr('disabled', false);
        $('.loading-indicator').hide();
      });
    } else {
      var handler = Plaid.create({
        ...linkHandlerCommonOptions,
        // webhook: 'https://your-domain.tld/plaid-webhook',
        onSuccess: function(public_token) {
          $.post('/get_access_token', {
            public_token: public_token
          }, function(data) {
            $('#container').fadeOut('fast', function() {
              $('#item_id').text(data.item_id);
              $('#access_token').text(data.access_token);
              $('#intro').hide();
              $('#app, #steps').fadeIn('slow');
            });
          });
        },
      });
      $('#link-btn').attr('disabled', false);
      $('.loading-indicator').hide();
    }

    var accessToken = qs('access_token');
    if (accessToken != null && accessToken != '') {
      $.post('/set_access_token', {
        access_token: accessToken
      }, function(data) {
        $('#container').fadeOut('fast', function() {
          $('#item_id').text(data.item_id);
          $('#access_token').text(accessToken);
          $('#intro').hide();
          $('#app, #steps').fadeIn('slow');
        });
      });
    }

    $('#link-btn').on('click', function(e) {
      handler.open();
    });

    $('#get-accounts-btn').on('click', function(e) {
      $.get('/accounts', function(data) {

        $('#get-accounts-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          var html = '<tr><td><strong>Name</strong></td><td><strong>Balances</strong></td><td><strong>Subtype</strong></td><td><strong>Mask</strong></td></tr>';
          data.accounts.accounts.forEach(function(account, idx) {
            html += '<tr>';
            html += '<td>' + account.name + '</td>';
            html += '<td>$' + (account.balances.available != null ? account.balances.available : account.balances.current) + '</td>';
            html += '<td>' + account.subtype + '</td>';
            html += '<td>' + account.mask + '</td>';
            html += '</tr>';
          });

          $(this).html(html).slideDown();
        });
      });
    });

 

    $('#get-identity-btn').on('click', function(e) {
      $.get('/identity', function(data) {
        $('#get-identity-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          var html = '';
          data.identity.accounts.forEach(function(account, idx) {
            html += '<tr><td><strong>' + account.name + '</strong></td></tr>';
            html += '<tr class="response-row response-row--is-identity"><td><strong>Names</strong></td><td><strong>Emails</strong></td><td><strong>Phone numbers</strong></td><td><strong>Addresses</strong></td></tr><tr class="response-row response-row--is-identity">';
            account.owners.forEach(function(identityData, idx) {
              html += '<tr><td>';
              identityData.names.forEach(function(name, idx) {
                html += name + '<br />';
              });
              html += '</td><td>';
              identityData.emails.forEach(function(email, idx) {
                html += email.data + '<br />';
              });
              html += '</td><td>';
              identityData.phone_numbers.forEach(function(number, idx) {
                html += number.data + '<br />';
              });
              html += '</td><td>';
              identityData.addresses.forEach(function(address, idx) {
                html += address.data.street + '<br />';
                html += address.data.city + ', ' + address.data.region + ' ' + address.data.postal_code;
              });
              html += '</td></tr>';
            })
          })
          $(this).html(html).slideDown();
        });
      });
    });

    $('#get-item-btn').on('click', function(e) {
      $.get('/item', function(data) {
        $('#get-item-data').slideUp(function() {
          if (data.error) {
            displayError(this, data.error);
          } else {
            var html = '';
            html += '<tr><td>Institution name</td><td>' + data.institution.name + '</td></tr>';
            html += '<tr><td>Billed products</td><td>' + data.item.billed_products.join(', ') + '</td></tr>';
            html += '<tr><td>Available products</td><td>' + data.item.available_products.join(', ') + '</td></tr>';

            $(this).html(html).slideDown();
          }
        });
      });
    });
    /*
        TRANSACTIONS
    */
    $('#get-transactions-btn').on('click', function(e) {
      $.get('/transactions', function(data) {
        transactionData = data
            transactionCheckLoop()
        if (data.error != null && data.error.error_code != null) {
          // Format the error
          var errorHtml = '<div class="inner"><p>' +
           '<strong>' + data.error.error_code + ':</strong> ' +
           (data.error.display_message == null ? data.error.error_message : data.error.display_message)  + '</p></div>';

          if (data.error.error_code === 'PRODUCT_NOT_READY') {
            // Add additional context for `PRODUCT_NOT_READY` errors
            errorHtml += '<div class="inner"><p>Note: The PRODUCT_NOT_READY ' +
             'error is returned when a request to retrieve Transaction data ' +
             'is made before Plaid finishes the <a href="https://plaid.com/' +
             'docs/quickstart/#transaction-data-with-webhooks">initial ' +
             'transaction pull.</a></p></div>';
          }
          // Render the error
          $('#get-transactions-data').slideUp(function() {
            $(this).slideUp(function() {
              $(this).html(errorHtml).slideDown();
            });
          });
        } else {
          $('#get-transactions-data').slideUp(function() {
            var html = '<tr><td><strong>Name</strong></td><td><strong>Amount</strong></td><td><strong>Date</strong></td></tr>';
            data.transactions.transactions.forEach(function(txn, idx) {
              html += '<tr>';
              html += '<td>' + txn.name + '</td>';
              html += '<td>$' + txn.amount + '</td>';
              html += '<td>' + txn.date + '</td>';
              html += '</tr>';
            });

            $(this).slideUp(function() {
              $(this).html(html).slideDown();
            });
          });
        }
      });
    });
    /*

      /*
        TRANSACTIONS - this month vs. last month
    */
    $('#get-transactions2-btn').on('click', function(e) {
      var dates = getDateRange()
      console.log(dates[1])
      if(typeof dates == 'undefined' || !dates){
        return false
      }
      $.get('/transactions?startDate='+dates[1][0].format('YYYY-MM-DD')+'&endDate='+dates[1][1].format('YYYY-MM-DD'), function(data) {
        transactionData = data
        transactionCheckLoop()

        if (data.error != null && data.error.error_code != null) {
          // Format the error
          var errorHtml = '<div class="inner"><p>' +
           '<strong>' + data.error.error_code + ':</strong> ' +
           (data.error.display_message == null ? data.error.error_message : data.error.display_message)  + '</p></div>';

          if (data.error.error_code === 'PRODUCT_NOT_READY') {
            // Add additional context for `PRODUCT_NOT_READY` errors
            errorHtml += '<div class="inner"><p>Note: The PRODUCT_NOT_READY ' +
             'error is returned when a request to retrieve Transaction data ' +
             'is made before Plaid finishes the <a href="https://plaid.com/' +
             'docs/quickstart/#transaction-data-with-webhooks">initial ' +
             'transaction pull.</a></p></div>';
          }
          // Render the error
          $('#get-transactions2-data').slideUp(function() {
            $(this).slideUp(function() {
              $(this).html(errorHtml).slideDown();
            });
          });
        } else {
          $('#get-transactions2-data').slideUp(function() {
            var html = '<tr><td><strong>Name</strong></td><td><strong>Amount</strong></td><td><strong>Date</strong></td></tr>';
            data.transactions.transactions.forEach(function(txn, idx) {
              html += '<tr>';
              html += '<td>' + txn.name + '</td>';
              html += '<td>$' + txn.amount + '</td>';
              html += '<td>' + txn.date + '</td>';
              html += '</tr>';
            });

            $(this).slideUp(function() {
              $(this).html(html).slideDown();
            });
          });
        }
      });
    });
    /*

      /*
        TRANSACTIONS - this month vs. last month
    */
    $('#get-transactions3-btn').on('click', function(e) {
      var twoMonthsAgo = moment().startOf('month').subtract('2','month')
      console.log(twoMonthsAgo)
      alert('here')
      $.get('/transactions?startDate='+twoMonthsAgo.format('YYYY-MM-DD')+'&endDate='+twoMonthsAgo.endOf('month').format('YYYY-MM-DD'), function(data) {
        transactionData = data
        transactionCheckLoop()

        if (data.error != null && data.error.error_code != null) {
          // Format the error
          var errorHtml = '<div class="inner"><p>' +
           '<strong>' + data.error.error_code + ':</strong> ' +
           (data.error.display_message == null ? data.error.error_message : data.error.display_message)  + '</p></div>';

          if (data.error.error_code === 'PRODUCT_NOT_READY') {
            // Add additional context for `PRODUCT_NOT_READY` errors
            errorHtml += '<div class="inner"><p>Note: The PRODUCT_NOT_READY ' +
             'error is returned when a request to retrieve Transaction data ' +
             'is made before Plaid finishes the <a href="https://plaid.com/' +
             'docs/quickstart/#transaction-data-with-webhooks">initial ' +
             'transaction pull.</a></p></div>';
          }
          // Render the error
          $('#get-transactions3-data').slideUp(function() {
            $(this).slideUp(function() {
              $(this).html(errorHtml).slideDown();
            });
          });
        } else {
          $('#get-transactions3-data').slideUp(function() {
            var html = '<tr><td><strong>Name</strong></td><td><strong>Amount</strong></td><td><strong>Date</strong></td></tr>';
            data.transactions.transactions.forEach(function(txn, idx) {
              html += '<tr>';
              html += '<td>' + txn.name + '</td>';
              html += '<td>$' + txn.amount + '</td>';
              html += '<td>' + txn.date + '</td>';
              html += '</tr>';
            });

            $(this).slideUp(function() {
              $(this).html(html).slideDown();
            });
          });
        }
      });
    });


  
    $('#get-balance-btn').on('click', function(e) {
      $.get('/balance', function(data) {
        $('#get-balance-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          var balanceData = data.balance;
          var html = '<tr><td><strong>Name</strong></td><td><strong>Balance</strong></td><td><strong>Subtype</strong></td><td><strong>Mask</strong></td></tr>';
          balanceData.accounts.forEach(function(account, idx) {
            html += '<tr>';
            html += '<td>' + account.name + '</td>';
            html += '<td>$' + (account.balances.available != null ? account.balances.available : account.balances.current) + '</td>'
            html += '<td>' + account.subtype + '</td>';
            html += '<td>' + account.mask + '</td>';
            html += '</tr>';
          });

          $(this).html(html).slideDown();
        });
      });
    });


  })(jQuery);

function qs(key) {
    key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); // escape RegEx meta chars
    var match = location.search.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)"));
    return match && decodeURIComponent(match[1].replace(/\+/g, " "));
}

function displayError(element, error) {
  var html = `
    <div class="alert alert-danger">
      <p><strong>Error Code:</strong> ${error.error_code}</p>
      <p><strong>Error Type:</strong> ${error.error_type}</p>
      <p><strong>Error Message:</strong> ${error.display_message == null ? error.error_message : error.display_message}</p>
      <div>Check out our <a href="https://plaid.com/docs/#errors-overview">errors documentation</a> for more information.</div>
    </div>`;
  $(element).html(html).slideDown();
}

function buildDiv(className,inner){
    var d = document.createElement('div')
    d.className = className
    d.innerHTML = (typeof inner != 'undefined' ? inner:'')
    return d
}

function getDateRange(len,date){
  // give date and length (month,year,week ?)
  if(typeof len == 'undefined'){
    // default to month
    len = 'month'
  }
  if(typeof date == 'undefined'){
    date = moment()
  }
  var startOf = moment(date).startOf(len)
  
  var endOf = moment(startOf).endOf(len)

  var startOfLast = moment(startOf).subtract(1,len).startOf(len)

  var endOfLast = moment(startOfLast).endOf(len)
  
  return [
    [startOf,endOf],
    [startOfLast,endOfLast]
  ]

}

// timeframe compare compares this week vs last week, this month vs last month, this year vs last year
function tfCompare(){
  // create two variables for loop to listen for both variables to be valid
  // get dates, issue two api calls, wait for response for both and mark variable as pending
  // callbacks update variables

}
function transactionCompare(){
    
    if(typeof transactionData2 != 'undefined'){
      // transform.
      if(transactionData2.error == null){
        if(typeof transactionData2.transactions != 'undefined'){
          if(typeof transactionData2.transactions.transactions != 'undefined'){
            if(typeof transactionData != 'undefined' && typeof transactionData.transactions){
              // being mega conservative here...

            }
          }
        }
      }
    }
}
// for filtering transactions
fieldFilter = ['category','date','name','amount','payment_channel','pending']


function transactionCheckLoop(start)
{
  console.log('transactionCheckLoop ' + start)
  if(typeof start == 'undefined'){
    if(typeof transactionData != 'undefined'){
      // transform.
      if(transactionData.error == null){
        if(typeof transactionData.transactions != 'undefined'){
         
          if(typeof transactionData.transactions.transactions != 'undefined'){
            var trxCollection = transactionData.transactions.transactions
            var preFilterCollection = []
            if(trxCollection.length > 0){
            
              trxCollection.filter(function(trx){
                var preFilter = {}
                for(var field in trx){
                  if(fieldFilter.indexOf(field) > -1){
                    preFilter[field]=true
                    if(field == 'name'){
                      // text transformation
                      preFilter[field] = trx[field].split(' ')
                         .map(w => w[0].toUpperCase() + w.substr(1).toLowerCase())
                         .join(' ')
                    }else if(field == 'category'){
                      preFilter[field] = trx[field].join(',')

                    }else{
                      preFilter[field] = trx[field]
                    }
                  }
                }
                preFilterCollection.push(preFilter)
              })
            }
            // build common categories
            transactionCats={}
            transactionCatsTotals={}
            transactionCatsTitles={}
            
            preFilterCollection.filter(function(t){
              var cat = t.category
              if(typeof transactionCats[cat] == 'undefined'){
                transactionCats[cat] = 1
                transactionCatsTotals[cat] = t.amount
                transactionCatsTitles[cat] = []
                transactionCatsTitles[cat].push(t.name)
              }else{
                transactionCats[cat] += 1
                transactionCatsTotals[cat] += t.amount
                var idxChk = transactionCatsTitles[cat].indexOf(t.name)
                // checking for duplicate transactions to modify the title name
                // rather than more elements
                  transactionCatsTitles[cat].push(t.name)
              }
            })

            // process duplicate transaction titles
            for(var cat in transactionCatsTitles){
                transactionCatsTitles[cat] = (transactionCatsTitles[cat].every( (val, i, arr) => val === arr[0] ) ?transactionCatsTitles[cat][0] : transactionCatsTitles[cat])
            }
            // vars for total cash in / cash out
            // deposits
            cashIn = 0
            // withdrawl
            cashOut = 0
            // group based on commas
            transactionGrouping= {}
            for(var cat in transactionCats){
              var cats = cat.split(',')
              var actionGrp = cats[0]
              var typeGrp = cats[1]
              if(typeof transactionGrouping[actionGrp] == 'undefined'){
                transactionGrouping[actionGrp] = []
              }
              var temp = {}
              temp['type']= typeGrp
              temp['count'] = transactionCats[cat]
              temp['total'] = transactionCatsTotals[cat]
              if(temp['total'] < 0){
                cashIn += temp['total']
              }else{
                cashOut += temp['total']
                
              }
              temp['transactions'] = transactionCatsTitles[cat]
              transactionGrouping[actionGrp].push(temp)
              // should i do the dom updating here?
            }
            // update dom
            // needs improvement ... 
            document.getElementById('cashIn').innerHTML = ''
            document.getElementById('cashIn').innerHTML = 'In<br/>$ ' + Math.abs(cashIn).toFixed(2)
            document.getElementById('cashOut').innerHTML = ''
            document.getElementById('cashOut').innerHTML = 'Out<br/>$ ' + cashOut.toFixed(2)
            document.getElementById('cashNet').innerHTML = 'Net<br/>$ ' + (Math.abs(cashIn) - cashOut).toFixed(2)
            
            document.getElementById('transactionGrouping').innerHTML=''
        
            for(var action in transactionGrouping){
              transactionGrouping[action].filter(function(grp){
                var div = buildDiv('item-data-row')
                var divLeft = buildDiv('item-data-row__left')
                divLeft.appendChild(
                  // group count
                    buildDiv('item-data-row__request-type ',grp.count)
                )
                var divLeftAction = buildDiv('item-data-row__request-type ' + action[0]+action[1],action[0]+action[1])

                divLeft.appendChild(divLeftAction)
                
                div.appendChild(divLeft)

                var divCenter = buildDiv('item-data-row__center')

                // grouping type                
                divCenter.appendChild(buildDiv('item-data-row__nicename',grp.type))
                
               // group title/transactions
                divCenter.appendChild(
                  buildDiv('item-data-row__description',grp.transactions)
                )

                div.appendChild(divCenter)

                var divRight = buildDiv('item-data-row__right')
                // dollar amount
                divRight.appendChild(
                  buildDiv('item-data-row__request-type',grp.total)
                )
             
                div.appendChild(divRight)
                
                document.getElementById('transactionGrouping').appendChild(div)
              })
            }
          }
          return clearInterval(transactionInterval)
        }
      }
    }
    return false
  }else{
    transactionInterval = setInterval(transactionCheckLoop,1000 * 5)
    return true
  }
}
transactionIntervalStatus = transactionCheckLoop(true) 
</script>
</body>
</html>
